# ğŸ¯ è‡ªå‹•æ ¼å¼æ¨æ–·ç³»çµ±

> ConvertX-CN é€éæœ¬åœ°è¦å‰‡å¼•æ“èˆ‡è¡Œç‚ºå­¸ç¿’ï¼Œè‡ªå‹•æ¨æ–·ä½¿ç”¨è€…æœ€å¯èƒ½çš„æ ¼å¼æœå°‹èˆ‡å¼•æ“é¸æ“‡ï¼Œä¸¦åœ¨ä¸å¹²æ“¾æ“ä½œè‡ªç”±çš„å‰æä¸‹ï¼Œæå‰å®Œæˆå¼•æ“æº–å‚™ä»¥é™ä½è½‰æª”å»¶é²ã€‚

## âœ¨ æ ¸å¿ƒäº®é»

- **ğŸš€ Cold Start å³å¯ç”¨**ï¼šç³»çµ±ç¬¬ä¸€æ¬¡ä½¿ç”¨å°±èƒ½çµ¦å‡ºåˆç†çš„é æ¸¬ï¼Œç„¡éœ€ç´¯ç©è³‡æ–™
- **ğŸ§  é›™å±¤é æ¸¬æ©Ÿåˆ¶**ï¼šè¦å‰‡å…ˆé©— (Rule-based) + å­¸ç¿’èª¿æ•´ (Learning-based)
- **âš¡ å¼•æ“é èª¿ç”¨**ï¼šé«˜ä¿¡å¿ƒåº¦æ™‚æå‰ warm-up å¼•æ“ï¼Œé™ä½å†·å•Ÿå‹•å»¶é²
- **ğŸ“Š æŒçºŒå­¸ç¿’**ï¼šæ¯æ¬¡è½‰æª”éƒ½æœƒæ›´æ–°ä½¿ç”¨è€…åå¥½æ¨¡å‹ï¼Œæ¨è–¦è¶Šç”¨è¶Šæº–
- **ğŸ”’ å®Œå…¨æœ¬åœ°**ï¼šä¸ä½¿ç”¨ä»»ä½•ä»˜è²» APIï¼Œæ‰€æœ‰æ¨æ–·åœ¨æœ¬åœ°å®Œæˆ
- **ğŸ›ï¸ ç„¡å¹²æ“¾è¨­è¨ˆ**ï¼šä½¿ç”¨è€…å¯éš¨æ™‚é»æ“Š X æ¸…é™¤æ¨è–¦ï¼Œç³»çµ±æœƒè¨˜éŒ„ç‚ºè² æ¨£æœ¬
- **ğŸ‘ï¸ å¯è¦–åŒ–æç¤º**ï¼šä½¿ç”¨è€…èƒ½æ¸…æ¥šçœ‹åˆ°ç³»çµ±é å¡«çš„å…§å®¹

## ğŸ—ï¸ é›™å±¤é æ¸¬æ¶æ§‹

### ç¬¬ä¸€å±¤ï¼šè¦å‰‡å…ˆé©— (Cold Start æ ¸å¿ƒ)

```
[æª”æ¡ˆä¸Šå‚³] â†’ [ç‰¹å¾µæŠ½å–] â†’ [è¦å‰‡åŒ¹é…] â†’ [å€™é¸æ ¼å¼ç”Ÿæˆ]
              â”‚              â”‚
              â”œâ”€ å‰¯æª”å      â”œâ”€ image_alpha â†’ PNG, WebP, AVIF
              â”œâ”€ MIME type   â”œâ”€ image_animation â†’ GIF, WebP
              â””â”€ æª”æ¡ˆç‰¹å¾µ    â””â”€ document_office â†’ PDF, DOCX
```

**è¦å‰‡å…ˆé©—ç¢ºä¿**ï¼š

- âœ… æ‹–å…¥ `image.png` â†’ ç«‹åˆ»å»ºè­° `jpg / webp / avif`
- âœ… æ‹–å…¥ `document.pdf` â†’ ç«‹åˆ»å»ºè­° `docx / txt / md`
- âœ… ç„¡éœ€ä»»ä½•æ­·å²è³‡æ–™å³å¯å·¥ä½œ

### ç¬¬äºŒå±¤ï¼šå­¸ç¿’èª¿æ•´ (æ’åºå„ªåŒ–)

```
[å€™é¸æ ¼å¼] + [ä½¿ç”¨è€…æ­·å²] â†’ [åˆ†æ•¸è¨ˆç®—] â†’ [æ’åº] â†’ [Top-K è¼¸å‡º]
                â”‚
                â”œâ”€ æ ¼å¼åå¥½è¨˜éŒ„
                â”œâ”€ æœ€è¿‘ä½¿ç”¨æ ¼å¼
                â””â”€ å…¨åŸŸæµè¡Œåº¦çµ±è¨ˆ
```

**å­¸ç¿’å±¤ç‰¹æ€§**ï¼š

- âŒ ä¸å½±éŸ¿ã€Œæ˜¯å¦æœ‰çµæœã€ï¼Œåªå½±éŸ¿ã€Œæ’åºã€
- âœ… éš¨ä½¿ç”¨æ¬¡æ•¸å¢åŠ ï¼Œé æ¸¬è¶Šä¾†è¶Šç²¾æº–

## ğŸ“ æ¨¡çµ„çµæ§‹

```
src/inference/
â”œâ”€â”€ index.ts                 # çµ±ä¸€å°å‡º
â”œâ”€â”€ inferenceService.ts      # æ¨æ–·æœå‹™ä¸»å…¥å£
â”œâ”€â”€ featureExtraction.ts     # æª”æ¡ˆç‰¹å¾µæŠ½å–
â”œâ”€â”€ formatCandidateRules.ts  # æ ¼å¼å€™é¸è¦å‰‡é…ç½® (Cold Start æ ¸å¿ƒ)
â”œâ”€â”€ formatPredictionModel.ts # æ ¼å¼é æ¸¬æ¨¡å‹ (é›™å±¤èåˆ)
â”œâ”€â”€ enginePredictionModel.ts # å¼•æ“é æ¸¬æ¨¡å‹
â”œâ”€â”€ behaviorStore.ts         # ä½¿ç”¨è€…è¡Œç‚ºè³‡æ–™å„²å­˜
â””â”€â”€ engineWarmup.ts          # å¼•æ“é èª¿ç”¨ç®¡ç†

public/
â””â”€â”€ inference.js             # å‰ç«¯æ¨æ–·æ•´åˆ (å« UX æç¤º)

src/pages/
â””â”€â”€ inference.tsx            # æ¨æ–· API ç«¯é»
```

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### å¾Œç«¯ API

```typescript
// è«‹æ±‚æ ¼å¼æ¨æ–·
POST /inference/predict
{
  "ext": "jpg",
  "file_size_kb": 2400
}

// å›æ‡‰
{
  "success": true,
  "data": {
    "format": {
      "search_token": "png",
      "confidence": 0.82,
      "top_k": [
        { "token": "png", "score": 0.82 },
        { "token": "webp", "score": 0.75 }
      ],
      "reason_codes": ["IMG_BASE"],
      "is_cold_start": true  // æ˜¯å¦ç‚º Cold Start é æ¸¬
    },
    "engine": {
      "engine": "vips",
      "confidence": 0.88,
      "should_warmup": true
    },
    "should_auto_fill": true
  }
}
```

### å‰ç«¯æ•´åˆ

```javascript
// ä¸Šå‚³æª”æ¡ˆå¾Œè‡ªå‹•è§¸ç™¼æ¨æ–·
if (window.inferenceModule) {
  const result = await inferenceModule.requestFormatInference("jpg", 2400);
  if (result?.should_auto_fill) {
    // ç¬¬ä¸‰å€‹åƒæ•¸è¡¨ç¤ºæ˜¯å¦ç‚º Cold Startï¼Œç”¨æ–¼é¡¯ç¤ºä¸åŒçš„ UX æç¤º
    inferenceModule.autoFillInferredFormat(
      result.format.search_token,
      result.engine?.engine,
      result.format.is_cold_start,
    );
  }
}
```

## ğŸ¨ ä½¿ç”¨è€…å¯æ„ŸçŸ¥è¡Œç‚º

### ç¬¬ä¸€æ¬¡ä½¿ç”¨æœƒçœ‹åˆ°

1. **æ§åˆ¶å°æ—¥èªŒ**ï¼š

   ```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  âœ… Format Prediction Engine Initialized            â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  âœ… Baseline format rules loaded (Cold-Start ready) â”‚
   â”‚  âœ… User intent simulation enabled                  â”‚
   â”‚  âœ… Auto-fill on file drop enabled                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ğŸ“Š Mode: Cold Start (è¦å‰‡å…ˆé©—)
   ```

2. **æ‹–å…¥æª”æ¡ˆå¾Œ**ï¼š
   - æœå°‹æ¡†è‡ªå‹•å¡«å…¥æ¨è–¦æ ¼å¼
   - æ—é‚Šé¡¯ç¤ºã€Œâœ¨ æ™ºæ…§æ¨è–¦: PNGã€æç¤º

3. **ä½¿ç”¨ä¸€æ®µæ™‚é–“å¾Œ**ï¼š
   - æç¤ºè®Šç‚ºã€Œâœ¨ æ‚¨å¸¸ç”¨çš„æ ¼å¼: PNGã€
   - æ’åºæœƒæ ¹æ“šä½¿ç”¨ç¿’æ…£èª¿æ•´

### æ€æ¨£ç¢ºèªå®ƒæœ‰åœ¨é‹ä½œ

1. é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…· (F12)
2. æŸ¥çœ‹ Console æ¨™ç±¤
3. ç¢ºèªçœ‹åˆ°ä¸Šè¿°åˆå§‹åŒ–æ—¥èªŒ
4. æ‹–å…¥ä»»æ„æª”æ¡ˆï¼Œæ‡‰çœ‹åˆ° `ğŸ¯ æ™ºæ…§æ¨è–¦: xxx` æ—¥èªŒ

## ğŸ“Š æ¬Šé‡é…ç½®

```typescript
// Cold Start å„ªåŒ–çš„æ¬Šé‡é…ç½®
const DEFAULT_WEIGHTS = {
  rule_prior_weight: 0.45, // è¦å‰‡å…ˆé©— (Cold Start æ ¸å¿ƒ)
  global_popularity_weight: 0.25, // å…¨åŸŸæµè¡Œåº¦
  user_history_weight: 0.15, // ä½¿ç”¨è€…æ­·å²
  feature_weight: 0.1, // æª”æ¡ˆç‰¹å¾µ
  recency_weight: 0.05, // æœ€è¿‘ä½¿ç”¨
};
```

**Cold Start æ™‚**ï¼š`0.45 + 0.25 + 0.10 = 0.80` çš„åˆ†æ•¸ä¾†è‡ªè¦å‰‡å’Œé è¨­å€¼

## âœ… é©—è­‰æ¸…å–®

| æ¸¬è©¦é …ç›®              | é æœŸçµæœ                 |
| --------------------- | ------------------------ |
| å‰›å®‰è£ â†’ æ‹–ç¬¬ä¸€å€‹æª”æ¡ˆ | é æ¸¬ç«‹åˆ»å‡ºç¾             |
| æ²’æœ‰æ­·å²è³‡æ–™          | ä»èƒ½é æ¸¬ (Cold Start)    |
| æ‰€æœ‰æ ¼å¼é¡å‹          | å…±ç”¨åŒä¸€å¥—é‚è¼¯           |
| å•Ÿå‹• Log              | é¡¯ç¤ºã€ŒCold-Start readyã€ |
| UX æç¤º               | é¡¯ç¤ºã€Œæ™ºæ…§æ¨è–¦ã€æ¨™ç±¤     |

## ğŸ“Š è³‡æ–™ Schema

### è½‰æª”äº‹ä»¶

```json
{
  "event": "conversion_completed",
  "user_id": 123,
  "input_ext": "jpg",
  "searched_format": "png",
  "selected_engine": "vips",
  "success": true,
  "duration_ms": 820
}
```

### ä½¿ç”¨è€… Profile

```json
{
  "user_id": 123,
  "format_preferences": {
    "jpg->png": 0.71,
    "jpg->webp": 0.19
  },
  "engine_preferences": {
    "png": { "vips": 0.65, "imagemagick": 0.3 }
  },
  "recent_formats": ["png", "webp", "pdf"]
}
```

## âš™ï¸ é…ç½®é¸é …

åœ¨ `InferenceServiceConfig` ä¸­å¯é…ç½®ï¼š

| é¸é …                        | é è¨­å€¼ | èªªæ˜               |
| --------------------------- | ------ | ------------------ |
| `formatConfidenceThreshold` | 0.4    | æ ¼å¼æ¨æ–·æœ€ä½ä¿¡å¿ƒåº¦ |
| `engineConfidenceThreshold` | 0.5    | å¼•æ“æ¨æ–·æœ€ä½ä¿¡å¿ƒåº¦ |
| `enableWarmup`              | true   | æ˜¯å¦å•Ÿç”¨é èª¿ç”¨     |
| `warmupConfidenceThreshold` | 0.7    | é èª¿ç”¨è§¸ç™¼é–¾å€¼     |

## ğŸ§ª é©—æ”¶æ¸¬è©¦

- âœ… ä½¿ç”¨è€…æ­·å²åå¥½ `jpgâ†’png` â†’ æ–° jpg è‡ªå‹•å¡« `png`
- âœ… é«˜è§£æ jpg â†’ vips å„ªå…ˆæ–¼ imagemagick
- âœ… å°åœ–ç¤º jpg â†’ imagemagick å„ªå…ˆ
- âœ… ä¸æœƒåœ¨åœ–ç‰‡æµç¨‹é èª¿ç”¨ ffmpeg
- âœ… ä½¿ç”¨è€…é» X â†’ æ¨æ–·è¢«è¨˜ç‚ºè² æ¨£æœ¬
- âœ… å¤šæ¬¡ä½¿ç”¨å¾Œæ¨è–¦æº–ç¢ºç‡æå‡
