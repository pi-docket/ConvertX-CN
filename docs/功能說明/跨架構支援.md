# è·¨æ¶æ§‹æ”¯æ´ï¼ˆMulti-Arch Supportï¼‰

ConvertX-CN Docker Image æ”¯æ´ **AMD64 (x86_64)** å’Œ **ARM64 (aarch64)** å…©ç¨®æ¶æ§‹ã€‚

---

## ç›®éŒ„

- [æ¶æ§‹æ”¯æ´ç¸½è¦½](#æ¶æ§‹æ”¯æ´ç¸½è¦½)
- [å·¥å…·å¯ç”¨æ€§å°ç…§è¡¨](#å·¥å…·å¯ç”¨æ€§å°ç…§è¡¨)
- [ARM64 é™åˆ¶èªªæ˜](#arm64-é™åˆ¶èªªæ˜)
- [ç¦ç”¨å¼•æ“åµæ¸¬æ©Ÿåˆ¶](#ç¦ç”¨å¼•æ“åµæ¸¬æ©Ÿåˆ¶)
- [é–‹ç™¼è€…æŒ‡å—](#é–‹ç™¼è€…æŒ‡å—)

---

## æ¶æ§‹æ”¯æ´ç¸½è¦½

### è¨­è¨ˆåŸå‰‡

1. **é–‹ç®±å³ç”¨**ï¼šDocker image å•Ÿå‹•å¾Œä¸éœ€è¦ä»»ä½•ä¸‹è¼‰æˆ–ç·¨è­¯
2. **å®‰å…¨é™ç´š**ï¼šARM64 ä¸Šç„¡æ³•å–å¾—çš„å·¥å…·æœƒè·³éï¼Œä¸å½±éŸ¿å…¶ä»–åŠŸèƒ½
3. **æ˜ç¢ºè­¦å‘Š**ï¼šè¢«è·³éçš„å·¥å…·æœƒåœ¨ build log å’Œ runtime ä¸­æ˜ç¢ºæ¨™ç¤º
4. **å®Œæ•´ AMD64**ï¼šAMD64 æ¶æ§‹ç¶­æŒ 100% åŠŸèƒ½å®Œæ•´

### æ¶æ§‹è™•ç†ç­–ç•¥

| ç­–ç•¥         | èªªæ˜                             |
| ------------ | -------------------------------- |
| å®˜æ–¹ Binary  | å„ªå…ˆä½¿ç”¨å®˜æ–¹é ç·¨è­¯ç‰ˆæœ¬ï¼ˆæœ€ç©©å®šï¼‰ |
| Source Build | å®˜æ–¹æ²’æœ‰é ç·¨è­¯æ™‚ï¼Œå¾æºç¢¼ç·¨è­¯     |
| è·³éä¸¦è­¦å‘Š   | ç„¡æ³•ç·¨è­¯æ™‚è·³éï¼Œä¸¦ç•™ä¸‹æ˜ç¢ºæ¨™è¨˜   |

---

## å·¥å…·å¯ç”¨æ€§å°ç…§è¡¨

| å·¥å…·                    | AMD64 | ARM64 | å®‰è£æ–¹å¼        | å‚™è¨»                     |
| ----------------------- | ----- | ----- | --------------- | ------------------------ |
| **FFmpeg 7.1.1**        | âœ…    | âœ…    | å®˜æ–¹éœæ…‹ binary | é›™æ¶æ§‹å‡æœ‰å®˜æ–¹ç‰ˆæœ¬       |
| **ImageMagick 7.1.2**   | âœ…    | âœ…    | æºç¢¼ç·¨è­¯        | é›™æ¶æ§‹å‡å¯ç·¨è­¯           |
| **libvips 8.18.0**      | âœ…    | âœ…    | æºç¢¼ç·¨è­¯        | é›™æ¶æ§‹å‡å¯ç·¨è­¯           |
| **Pandoc 3.8.3**        | âœ…    | âœ…    | å®˜æ–¹ binary     | é›™æ¶æ§‹å‡æœ‰å®˜æ–¹ç‰ˆæœ¬       |
| **LibreOffice 25.8.4**  | âœ…    | âœ…    | å®˜æ–¹ deb        | é›™æ¶æ§‹å‡æœ‰å®˜æ–¹ç‰ˆæœ¬       |
| **Calibre 8.16.2**      | âœ…    | âœ…    | å®˜æ–¹ binary     | é›™æ¶æ§‹å‡æœ‰å®˜æ–¹ç‰ˆæœ¬       |
| **Ghostscript 10.06.0** | âœ…    | âœ…    | æºç¢¼ç·¨è­¯        | é›™æ¶æ§‹å‡å¯ç·¨è­¯           |
| **resvg 0.46.0**        | âœ…    | âš ï¸    | Binary / Source | ARM64 å˜—è©¦ç·¨è­¯ï¼Œå¯èƒ½å¤±æ•— |
| **MinerU**              | âœ…    | âŒ    | pip             | PyTorch é™åˆ¶             |
| **vtracer**             | âœ…    | âœ…    | å®˜æ–¹ binary     | é›™æ¶æ§‹å‡æœ‰å®˜æ–¹ç‰ˆæœ¬       |
| **dasel**               | âœ…    | âœ…    | å®˜æ–¹ binary     | é›™æ¶æ§‹å‡æœ‰å®˜æ–¹ç‰ˆæœ¬       |

### åœ–ä¾‹

- âœ… å®Œæ•´æ”¯æ´
- âš ï¸ å˜—è©¦æ”¯æ´ï¼ˆå¯èƒ½å¤±æ•—ï¼‰
- âŒ ä¸æ”¯æ´ï¼ˆå·²è·³éï¼‰

---

## ARM64 é™åˆ¶èªªæ˜

### resvg

**ç‹€æ³**ï¼šå®˜æ–¹æ²’æœ‰ ARM64 Linux é ç·¨è­¯ç‰ˆæœ¬

**è™•ç†æ–¹å¼**ï¼š

1. åœ¨ build time å˜—è©¦ç”¨ Rust å¾æºç¢¼ç·¨è­¯
2. è‹¥ç·¨è­¯æˆåŠŸ â†’ resvg å¯ç”¨
3. è‹¥ç·¨è­¯å¤±æ•— â†’ è·³éä¸¦æ¨™è¨˜ç‚ºç¦ç”¨

**å½±éŸ¿**ï¼š

- SVG â†’ PNG è½‰æ›å¯èƒ½ä¸å¯ç”¨
- å¯ä½¿ç”¨ Inkscape æˆ– ImageMagick ä½œç‚ºæ›¿ä»£

### MinerU

**ç‹€æ³**ï¼šä¾è³´ PyTorchï¼ŒARM64 æ”¯æ´æœ‰é™

**è™•ç†æ–¹å¼**ï¼š

1. åœ¨ ARM64 ä¸Šå®Œå…¨è·³éå®‰è£
2. ç›¸é—œ PDF â†’ Markdown åŠŸèƒ½ä¸å¯ç”¨

**æ›¿ä»£æ–¹æ¡ˆ**ï¼š

- ä½¿ç”¨ Pandoc é€²è¡ŒåŸºæœ¬ PDF è½‰æ›
- ä½¿ç”¨ OCRmyPDF é€²è¡Œ OCR

---

## ç¦ç”¨å¼•æ“åµæ¸¬æ©Ÿåˆ¶

### ç’°å¢ƒè®Šæ•¸

è¢«ç¦ç”¨çš„å¼•æ“æœƒè¨­å®šå°æ‡‰çš„ç’°å¢ƒè®Šæ•¸ï¼š

```bash
# resvg è¢«ç¦ç”¨
RESVG_DISABLED=1
```

### æª”æ¡ˆæ¨™è¨˜

è¢«ç¦ç”¨çš„å¼•æ“æœƒåœ¨ä»¥ä¸‹ç›®éŒ„ç•™ä¸‹æ¨™è¨˜æª”æ¡ˆï¼š

```
/opt/convertx/disabled-engines/
â”œâ”€â”€ resvg      # resvg è¢«ç¦ç”¨
â””â”€â”€ mineru     # MinerU è¢«ç¦ç”¨ï¼ˆARM64ï¼‰
```

### ç¨‹å¼ç¢¼æª¢æ¸¬

```typescript
import { getDisabledEngines } from "./converters/main";

const disabled = getDisabledEngines();
if (disabled.includes("resvg")) {
  console.log("resvg ä¸å¯ç”¨ï¼Œä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ");
}
```

### API æŸ¥è©¢

```bash
# æŸ¥è©¢ç¦ç”¨å¼•æ“
curl http://localhost:3000/api/engines/disabled
```

å›æ‡‰ç¯„ä¾‹ï¼š

```json
{
  "disabled": ["resvg", "mineru"],
  "platform": "arm64"
}
```

---

## é–‹ç™¼è€…æŒ‡å—

### æ–°å¢è·¨æ¶æ§‹å·¥å…·

ç•¶æ–°å¢ä¸€å€‹å¯èƒ½æœ‰è·¨æ¶æ§‹å•é¡Œçš„å·¥å…·æ™‚ï¼Œè«‹éµå¾ªä»¥ä¸‹æ¨¡å¼ï¼š

#### Dockerfile ç¯„ä¾‹

```dockerfile
# å·¥å…·åç¨±ï¼ˆè·¨æ¶æ§‹æ”¯æ´ï¼‰
ARG TOOL_VERSION=1.0.0
RUN set -ex && \
  mkdir -p /opt/convertx/disabled-engines && \
  ARCH=$(uname -m) && \
  if [ "$ARCH" = "aarch64" ]; then \
    # ARM64 è™•ç†
    if å˜—è©¦å®‰è£å‘½ä»¤; then \
      echo "âœ… [ARM64] å·¥å…·å®‰è£æˆåŠŸ"; \
    else \
      echo "âš ï¸ [ARM64] å·¥å…·å®‰è£å¤±æ•—ï¼ŒåŠŸèƒ½ç¦ç”¨" && \
      echo "tool_name" > /opt/convertx/disabled-engines/tool_name && \
      echo "TOOL_DISABLED=1" >> /etc/environment; \
    fi; \
  else \
    # AMD64 è™•ç†ï¼ˆæ¨™æº–å®‰è£ï¼‰
    å®‰è£å‘½ä»¤ && \
    echo "âœ… [AMD64] å·¥å…·å®‰è£æˆåŠŸ"; \
  fi
```

#### TypeScript ç¯„ä¾‹

```typescript
import { existsSync } from "node:fs";

export function isToolAvailable(): boolean {
  if (process.env.TOOL_DISABLED === "1") {
    return false;
  }
  if (existsSync("/opt/convertx/disabled-engines/tool_name")) {
    return false;
  }
  return true;
}
```

### æ¸¬è©¦è·¨æ¶æ§‹å»ºç½®

```bash
# å»ºç½® AMD64 ç‰ˆæœ¬
docker buildx build --platform linux/amd64 -t convertx:amd64 .

# å»ºç½® ARM64 ç‰ˆæœ¬
docker buildx build --platform linux/arm64 -t convertx:arm64 .

# é©—è­‰å¼•æ“ç‹€æ…‹
docker run --rm convertx:arm64 cat /opt/convertx/disabled-engines/*
```

---

## å¸¸è¦‹å•é¡Œ

### Q: ARM64 ä¸Š resvg ä¸å¯ç”¨æ€éº¼è¾¦ï¼Ÿ

ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆï¼š

```bash
# ä½¿ç”¨ Inkscape
inkscape input.svg --export-filename=output.png

# ä½¿ç”¨ ImageMagick
magick input.svg output.png
```

### Q: å¦‚ä½•çŸ¥é“å“ªäº›å¼•æ“è¢«ç¦ç”¨ï¼Ÿ

1. æŸ¥çœ‹ Docker build logï¼ˆæœƒé¡¯ç¤º âš ï¸ è­¦å‘Šï¼‰
2. æª¢æŸ¥ `/opt/convertx/disabled-engines/` ç›®éŒ„
3. ä½¿ç”¨ API æŸ¥è©¢ `/api/engines/disabled`

### Q: ARM64 æ•ˆèƒ½å¦‚ä½•ï¼Ÿ

- å¤§éƒ¨åˆ†å·¥å…·æ•ˆèƒ½ç›¸ç•¶
- æºç¢¼ç·¨è­¯çš„å·¥å…·å¯èƒ½ç¨æ…¢ï¼ˆåˆæ¬¡å»ºç½®æ™‚ï¼‰
- å»ºè­°ä½¿ç”¨ Apple Silicon Mac æˆ– AWS Graviton é€²è¡Œæ¸¬è©¦

---

[â¬†ï¸ å›åˆ°é ‚éƒ¨](#è·¨æ¶æ§‹æ”¯æ´multi-arch-support) | [ğŸ“š å›åˆ°ç›®éŒ„](../00-å°ˆæ¡ˆç¸½è¦½.md)
